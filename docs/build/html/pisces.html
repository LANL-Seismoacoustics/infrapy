<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Database Interfacing &mdash; Infrapy 1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Utility Functions" href="utilities.html" />
    <link rel="prev" title="InfraView" href="infraview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Infrapy
            <img src="_static/lanl_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="userguide.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="authorship.html">Authorship</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="infraview.html">InfraView</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Database Interfacing</a></li>
<li class="toctree-l1"><a class="reference internal" href="utilities.html">Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="algorithms.html">Algorithms</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Infrapy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Database Interfacing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/pisces.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="database-interfacing">
<span id="pisces"></span><h1>Database Interfacing<a class="headerlink" href="#database-interfacing" title="Permalink to this headline"></a></h1>
<p>Infrapy leverages pisces to connect with and process data in databases. More information about pisces can be found at <a class="reference external" href="https://jkmacc-lanl.github.io/pisces/">https://jkmacc-lanl.github.io/pisces/</a>.  The methods described here are still in active development; therefore, if something doesn’t work please contact both the infrapy POCs as well as the pisces POCs for assistance and clarification.</p>
<section id="defining-database-connection-info">
<h2>Defining Database Connection Info<a class="headerlink" href="#defining-database-connection-info" title="Permalink to this headline"></a></h2>
<ul>
<li><p>In order to connect and pull data from a database, the pisces methods need to establish a database session and perform a number of table queries.  The information needed to connect and perform these queries is defined within a separate configuation file specifically for the database that can be defined either on the command line using <code class="code docutils literal notranslate"><span class="pre">--db-config</span></code> or in a general infrapy configuration file as below:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[WAVEFORM IO]
db_config = /path/to/database_info.config

station = I53*
channel = *DF
starttime = 2018-12-19T01:00:00
endtime = 2018-12-19T03:00:00

...
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>The database configuration file includes information about the database itself (e.g., schema, dialect, hostname) as well as a list of database table names that will be queried and used in analysis.  An example database configuration file contents is below:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[DATABASE]
schema = KBCore
dialect = oracle
hostname = my_host.com
database_name = my_db
port = 1234
driver =
username =
password =
owner = my_account

[DBTABLES]
wfdisc = wfdisc
site = site
</pre></div>
</div>
<ul class="simple">
<li><p>Note that the driver, username, and password fields are optional and if accessing your database doesn’t require them they can be left out of the config file or simply left blank as in the above</p></li>
<li><p>The owner information is used in combination with the database table list to define the actual table names (e.g., the above would define the site table reference as <code class="code docutils literal notranslate"><span class="pre">my_account.site</span></code>).</p></li>
<li><p>Add notes about other fields?</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="accessing-waveform-data-from-the-database">
<h2>Accessing Waveform Data from the Database<a class="headerlink" href="#accessing-waveform-data-from-the-database" title="Permalink to this headline"></a></h2>
<ul>
<li><p>The utility function, <code class="code docutils literal notranslate"><span class="pre">infrapy</span> <span class="pre">utils</span> <span class="pre">check-db-wvfrms</span></code>, can be used to check what waveform data will be extracted to ensure that your database connection is working and that data is being pulled correctly.  An example output of this function is shown below:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#################################
##                             ##
##      InfraPy Utilities      ##
##       check_db_wvfrms       ##
##                             ##
#################################


Loading configuration info from: my_configuration.config

Data parameters:
  db_config: /path/to/database_info.config
  network: None
  station: I53*
  location: None
  channel: *DF
  starttime: 2018-12-19T01:00:00
  endtime: 2018-12-19T03:00:00

Loading data from database...

Data summary:
__.I53H1..BDF   2018-12-19T01:00:00.000000Z - 2018-12-19T03:00:00.000000Z
__.I53H2..BDF   2018-12-19T01:00:00.000000Z - 2018-12-19T03:00:00.000000Z
__.I53H3..BDF   2018-12-19T01:00:00.000000Z - 2018-12-19T03:00:00.000000Z
__.I53H4..BDF   2018-12-19T01:00:00.000000Z - 2018-12-19T03:00:00.000000Z
__.I53H5..BDF   2018-12-19T01:00:00.000000Z - 2018-12-19T03:00:00.000000Z
__.I53H6..BDF   2018-12-19T01:00:00.000000Z - 2018-12-19T03:00:00.000000Z
__.I53H7..BDF   2018-12-19T01:00:00.000000Z - 2018-12-19T03:00:00.000000Z
__.I53H8..BDF   2018-12-19T01:00:00.000000Z - 2018-12-19T03:00:00.000000Z

Location info:
64.87500        -147.86114
64.87236        -147.83828
64.86208        -147.84281
64.85914        -147.86615
64.86805        -147.87858
64.86722        -147.86120
64.86617        -147.85670
64.86541        -147.85990
</pre></div>
</div>
<ul class="simple">
<li><p>Note that all 8 channels of the I53 station are found in the database and the displayed start and end times indicate that the requested 2 hours of data are able to be pulled.  The latitude and longitude of the various station elements are summarized for completeness.</p></li>
<li><p>Also, pulling waveform data from a database requires only the <code class="code docutils literal notranslate"><span class="pre">site</span></code> table to identify station information and <code class="code docutils literal notranslate"><span class="pre">wfdisc</span></code> to access waveform data.  Additional tables will be required for attaching response information (currently data is returned in counts and not physical units) and other advances in accessing waveform data.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Running and visualizing beamforming analysis with this data can now be done using the same <code class="code docutils literal notranslate"><span class="pre">my_configuration.config</span></code> file with parameter modifications and other details as discussed in the <a class="reference internal" href="quickstart.html#quickstart"><span class="std std-ref">Quickstart</span></a>.  Essentially, when pulling waveform data for analysis, our aim is to be able to point the infrapy methods to a database via pisces and a <code class="code docutils literal notranslate"><span class="pre">database_info.config</span></code> file as easily as pointing it at an FDSN.</p></li>
</ul>
</section>
<section id="writing-analysis-results-into-the-database">
<h2>Writing Analysis Results into the Database<a class="headerlink" href="#writing-analysis-results-into-the-database" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Currently, analysis results using waveform data pulled from a database are written into […].fk_results.dat and […].dets.json files as discussed in the <a class="reference internal" href="quickstart.html#quickstart"><span class="std std-ref">Quickstart</span></a>.  In future developments, methods to write those results back into database tables will be implemented.</p></li>
<li><p>The current plan is to implement such functionality as part of the <a class="reference internal" href="utilities.html#utilities"><span class="std std-ref">Utility Functions</span></a> methods and include methods to both write detection results into the appropriate tables as well as pull detections from a database for event ID and similar analysis.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="infraview.html" class="btn btn-neutral float-left" title="InfraView" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="utilities.html" class="btn btn-neutral float-right" title="Utility Functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, F.Dannemann Dugick, P.Blom, J.Webster.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>